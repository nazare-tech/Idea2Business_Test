name: bootstrap-nextjs

on:
  workflow_dispatch:
    inputs:
      app_dir:
        description: "Directory to create the app in"
        required: true
        default: "app"
        type: string
      package_manager:
        description: "npm | pnpm | yarn"
        required: true
        default: "npm"
        type: string

permissions:
  contents: write

jobs:
  bootstrap:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Create Next.js app
        run: |
          DIR="${{ github.event.inputs.app_dir }}"
          PM="${{ github.event.inputs.package_manager }}"

          # If directory already exists, don't recreate
          if [ -d "$DIR" ] && [ "$(ls -A "$DIR" 2>/dev/null)" ]; then
            echo "Directory $DIR already exists and is not empty. Skipping create-next-app."
          else
            if [ "$PM" = "pnpm" ]; then
              corepack enable
              pnpm dlx create-next-app@latest "$DIR" --ts --eslint --tailwind --app --src-dir --use-pnpm --yes
            elif [ "$PM" = "yarn" ]; then
              yarn create next-app "$DIR" --typescript --eslint --tailwind --app --src-dir --yes
            else
              npx create-next-app@latest "$DIR" --ts --eslint --tailwind --app --src-dir --use-npm --yes
            fi
          fi

      - name: Commit & push
        run: |
          git config user.name "n8n-bot"
          git config user.email "n8n-bot@users.noreply.github.com"
          git add -A
          git commit -m "Bootstrap Next.js app" || echo "No changes"
          git push
